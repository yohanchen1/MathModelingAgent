# 数学建模代理 (MathModelingAgent) - v2.0

---

## 摘要 (Abstract)

本项目是一个高级AI代理，旨在自动化解决复杂的、多步骤的数学建模问题。它借鉴了`IMO25`项目通过“分解”和“迭代”解决复杂推理任务的核心思想，并将其应用于数学建模领域。代理能够智能地将一个复杂的问题文档（如PDF）分解为多个独立的子问题，然后对每个子问题进行多轮的“建模-分析-修正”循环，从而逐步求精，生成高质量的、包含完整代码和分析的解决方案。

其核心能力在于：
1.  **智能问题分解**: 自动从问题文档中提取独立的子问题。
2.  **顺序求解**: 逐一解决每个子问题，并将前一个问题的解作为后续问题的上下文。
3.  **迭代式自我修正**: 对每个子问题的解进行两轮“生成-验证-修正”循环，显著提升了方案的深度和可靠性。
4.  **结构化输出**: 为每个子问题的解决过程生成独立的、详细的运行日志、思考过程日志和可视化图表。

这不仅是一个解题工具，更是一次关于“如何让AI进行深度、结构化、多步骤推理”的成功探索。

## 核心方法论 (Core Methodology)

该框架的核心是一个三阶段的自动化流程：

1.  **问题提取 (Problem Extraction)**:
    *   代理首先读取用户提供的问题目录中的PDF文件。
    *   通过一次LLM调用，它会智能地识别并提取出PDF中所有独立的、编号的子问题（例如，“问题一”、“问题二”等）。

2.  **顺序求解 (Sequential Solving)**:
    *   代理将提取出的子问题列表作为任务队列。
    *   它会按顺序逐一解决每个子问题。在解决后续问题时，它会自动将前面所有问题的最终解决方案作为上下文，确保了知识的连贯性和递进。

3.  **迭代修正循环 (Iterative Refinement Loop)**:
    *   对于**每一个**子问题，代理都会启动一个两轮的“生成-验证”循环：
        *   **第一轮 (Initial Modeling)**: “建模者”角色根据当前子问题和已有上下文，生成第一版解决方案（包含分析、代码和结论）。
        *   **第一轮 (Analysis)**: “分析者”角色对第一版方案进行严格的批判性审查，找出其中的逻辑谬误、未验证的假设或潜在的缺陷。
        *   **第二轮 (Correction)**: “建模者”角色接收“分析者”的“bug报告”，并进行针对性的修正，生成第二版、也是最终版的解决方案。

这种“先分解、再逐一击破、最后自我完善”的策略，有效地克服了大型语言模型在处理复杂长程推理任务时的“思考预算”限制，显著提升了最终解决方案的质量。

## 设计灵感 (Inspiration)

本项目的设计思路，很大程度上受到了近年来AI在形式推理领域探索的启发，特别是借鉴了 [lyang36/IMO25](https://github.com/lyang36/IMO25) 项目在解决国际数学奥林匹克问题上所采用的多代理“生成-验证”和“分解问题”的思想。

## 环境配置 (Setup)

1.  **克隆仓库**

2.  **创建Python虚拟环境** (推荐使用Conda)
    ```bash
    conda create --name math_modeling python=3.9 -y
    conda activate math_modeling
    ```

3.  **安装依赖项**
    ```bash
    pip install -r requirements.txt
    ```

4.  **配置API密钥**
    本项目中的API密钥和模型已根据您的要求，在 `code/agent.py` 脚本中硬编码：
    ```python
    API_KEY = "sk-KAdal9IRxAROnEA53aD2DfC6DdD24dDaBbAf3a13FbC5513e"
    MODEL_NAME = "gemini-2.5-flash"
    ```
    如果需要更换，请直接修改此文件。

## 使用指南 (Usage)

通过命令行执行代理，并使用 `--dir` 参数提供包含问题文件（PDF和相关附件）的目录路径。

```bash
# 在 MathModelingAgent 项目根目录下运行
python code/agent.py --dir problems/cumcm2023
```

- 一个完整的示例问题位于 `problems/cumcm2023` 目录中。
- 代理将自动识别PDF文件和附件。

## 输出结构 (Output Structure)

所有生成的思考过程和结果都保存在 `run_logs` 文件夹中，结构如下：

```
MathModelingAgent/
└── run_logs/
    ├── plots/                     # 存放所有由代码生成的图表 (.png)
    |   ├── plot_problem_1_...
    |   └── ...
    ├── run_log_problem_1.txt      # 问题一的完整解决过程日志
    ├── run_log_problem_2.txt      # 问题二的完整解决过程日志
    ├── ...
    ├── thinking_log_extraction.txt # 提取问题的思考过程
    ├── thinking_log_problem_1_modeler_1.txt # 问题一，第一轮，建模者思考过程
    ├── thinking_log_problem_1_analyzer_1.txt# 问题一，第一轮，分析者思考过程
    ├── thinking_log_problem_1_modeler_2.txt # 问题一，第二轮，建模者思考过程
    └── ...
```

## 未来工作 (Future Work)

- **增强代码执行与调试**: 集成一个代码执行环境，让代理不仅能生成代码，还能运行代码、读取输出、并根据错误进行自主调试。
- **扩展模型库**: 支持更多类型的数学模型，如微分方程、图论、随机过程等，并让代理能根据问题类型自动选择最合适的模型。
- **引入更复杂的评估体系**: 开发一套能够从多维度（如模型创新性、结果准确性、现实意义）自动评估方案质量的框架，甚至引入第三个“裁判”代理。

---

我们欢迎任何形式的交流与贡献，共同探索AI在科学计算领域的未来。